---
layout: post
title: Javascript는 어떻게 동작할까? (1부)
categories: [Javascript]
tags: []
fullview: false
comments: true
---

### Intro
프로그래밍 언어를 사용하여 본인이 원하는 프로그램을 개발하기 위해서는 해당 언어가 어떻게 동작하는지 이해할 필요가 있다고 생각합니다.
왜냐하면 "좋은 코드"를 작성하기 위한 토대가 될 수 있기 때문입니다. 각자가 생각하는 "좋은 코드"의 조건은 다르지만 "좋은 코드"를 알아보고 본인의 기준을 세우기 위해서는 언어의 동작 원리를 이해하는 것이 도움이 됩니다.

먼저 자바스크립트가 런타임 환경에서 어떻게 동작하는지 알아보고, 크롬에서 사용되는 자바스크립트 엔진인 V8을 자세히 알아보려고 합니다.

---

### 런타임 환경
자바스크립트로 작성된 코드가 실제로 실행되는 환경을 `런타임 환경`이라고 합니다. 자바스크립트는 Chrome, Node.js 등에서 실행될 수 있습니다. 이 중에서 Chrome에서 자바스크립트가 어떻게 실행되는지 이야기해보겠습니다. (Chrome과 Node.js 모두 V8 엔진을 사용하고 있습니다.)  

---

### 콜 스택
자바스크립트 엔진은 **콜 스택**을 갖고 있습니다. 코드가 실행되면서 순차적으로 콜 스택에 쌓이게 됩니다. 아래의 코드를 통해 알아보겠습니다.
```javascript
function foo() {
  console.log('hello foo');
  function bar() {
    console.log('hello bar');
    }
  bar();
  }
foo();
```
전역에서 foo()를 호출하여 콜 스택에 push하여 실행됩니다. 이후 foo함수 내에서 bar()가 호출이 되면서 콜 스택에 push됩니다. 지금까지 콜 스택의 상황은 가장 아래에 foo, 가장 위에 bar 함수가 존재하게 됩니다. 이후 bar함수가 할 일을 다하여 종료되면 콜 스택에서 pop이 됩니다. 이후 foo함수도 종료되면서 콜 스택에서 pop이 됩니다.
스택의 성질을 이용하여 가장 먼저 호출된 함수가 가장 늦게 제거되었습니다.

이처럼 콜 스택은 생성된 `실행 컨텍스트`를 순차적으로 저정하는 역할을 합니다. 또한 자바스크립트는 하나의 콜 스택을 사용하기때문에 한 번에 하나의 일만 할 수 있는 `싱글 스레드 언어`입니다.

---

### 이벤트 루프와 태스크 큐
콜 스택은 자바스크립트 엔진인 V8의 구성요소입니다. 하지만 런타임 환경에서 Chrome과 같은 브라우저가 지원해주는 도구들이 있습니다. 그것이 바로 **이벤트 루프**와 **태스크 큐(Task Queue)** 입니다.


자바스크립트에 setTimeout, setInterval 등의 API를 사용해봤을 것입니다. 이것은 자바스크립트에서 지원하는 것이 아닌 Web에서 지원하는 Web API영역 입니다. 아래의 코드가 어떻게 동작할지 예상이 되시나요?
```javascript
console.log("hello");

setTimeout(() => {
  console.log("timer");
}, 3000);

console.log("bye");
```

먼저 콜 스택에 "hello"를 출력하는 함수가 push되어 실행됩니다. 이후 setTimeout문을 만나게 되고 콜 스택에 push 되는 것이 아니라 3000ms를 기다리게 됩니다. 마지막으로 "bye"를 출력하는 함수가 콜 스택에 push되어 실행됩니다. 

3000ms이후에는 setTimeout이 태스크 큐에 push 됩니다.(3000ms 이후에 콜백 함수가 실행되는 것이 아니라, 태스크 큐에 push 됩니다.) 태스크 큐는 setTimeout과 같이 비동기 함수의 콜백 함수, 이벤트 핸들러 등이 일시적으로 보관되는 장소입니다. 이벤트 루프는 콜 스택이 비어있다는 것을 확인한 후에 태스크 큐에 있는 콜백 함수를 pop하여 콜 스택에 push합니다.

---

### 마무리
1부에서는 자바스크립트 코드가 런타임 환경에서 어떻게 실행되는지 알아봤습니다.
자바스크립트 엔진에서 제공하는 콜 스택을 통해 생성된 실행 컨텍스트를 순차적으로 저장하여 실행시킵니다. 또한 이벤트 루프, 태스크 큐를 통해 비동기 요청을 하고 동시성 처리를 할 수 있습니다.

2부에서는 런타임 환경이 아닌 자바스크립트 엔진인 V8이 어떻게 코드를 해석하고 실행시키는지 좀 더 내부적으로 자세히 알아보겠습니다.


